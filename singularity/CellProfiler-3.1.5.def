Bootstrap: debootstrap
OSVersion: bionic
MirrorURL: http://us.archive.ubuntu.com/ubuntu/

%post
    apt-get -y update
    apt-get -y upgrade
  
    #add the add-apt-repository cmd and add universe and multiverse repositories
    apt-get install -y software-properties-common 
    add-apt-repository "deb http://us.archive.ubuntu.com/ubuntu/ bionic universe multiverse"
    add-apt-repository "deb http://us.archive.ubuntu.com/ubuntu/ bionic-updates universe multiverse"
    
    #locale
    apt-get install -y locales
    locale-gen en_US.UTF-8 en_US en_CA.UTF-8 en_CA

    #install base
    apt-get install -y \
        build-essential    \
        cython             \
        git                \
        libmysqlclient-dev \
        libhdf5-dev        \
        libxml2-dev        \
        libxslt1-dev       \
        openjdk-8-jdk      \
        python-dev         \
        python-pip         \
        python-h5py        \
        python-mysqldb     \
        python-vigra       \
        python-wxgtk3.0    \
        python-zmq     \
        wget

    #Gtk-Message: 14:41:54.536: Failed to load module "canberra-gtk-module"
    apt-get install -y libcanberra-gtk3-module

    #CellProfiler setup.py does not cover everything
    pip install pytest
    pip install matplotlib==2.2.2
    pip install pillow
    pip install python-dateutil
    pip install sklearn

    #install CellProfiler
    wget https://github.com/CellProfiler/CellProfiler/archive/v3.1.5.tar.gz && \
    pip install v3.1.5.tar.gz --no-cache-dir && \
    rm -rf v3.1.5.tar.gz

%labels
    Maintainer Nick Wang
    AUTHOR nick.wang@sickkids.ca
    Version 1.0

%help
    Base image for CellProfiler 3.1.5. Contains only standard and 3rd party packages.
